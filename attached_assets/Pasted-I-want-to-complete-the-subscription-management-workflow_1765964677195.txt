I want to complete the subscription management workflow by wiring the frontend to the Stripe Customer Portal. The goal is:
â€¢	Add a button labelled â€œManage Billing & Subscriptionâ€, to the Manage Subscription page, to the right of where â€œSubscriptionâ€ is shown at the top, that lets users open the Stripe Customer Portal.
â€¢	Move the auto renew toggle to the right of the â€œRenews onâ€ text near the top, just below the new. And make the â€œRenews onâ€ text change to â€œExpires onâ€ when the toggle has been set to off e.g. when the subscription wonâ€™t auto renew
â€¢	Users can manage invoices, payment methods, or change/cancel subscriptions directly in Stripe through the â€œManageâ€ button.
â€¢	After finishing in Stripe, they should be redirected back to the same page in the app (/account).
âœ… Whatâ€™s already in place
Stripe setup
â€¢	The Stripe Customer Portal has been configured in the Stripe Dashboard.
â€¢	Redirect link is set to https://elementle-game.replit.app/account, but this can be changed if you need to setup a different URL to ensure the user returns to the Manage Subscription page.
Edge Function: manage-billing
â€¢	Path: /functions/v1/manage-billing
â€¢	Method: POST
â€¢	Inputs:
o	customerId â†’ comes from user_profiles.stripe_customer_id
o	returnUrl â†’ optional, defaults to https://elementle-game.replit.app/account
â€¢	Output: { url: session.url } (the Stripe portal session URL)
â€¢	Handles CORS preflight and matches the same pattern as update-auto-renew.
Database schema (relevant fields)
â€¢	user_profiles.stripe_customer_id â†’ used to identify the customer in Stripe.
â€¢	user_subscriptions â†’ updated automatically via webhook when changes are made in Stripe.
â€¢	No frontend wiring yet for the portal.
ğŸ“Œ Specific asks for you to implement:
1. Add a new button to Manage Subscription page, to the right of â€œSubscriptionâ€
â€¢	Label: â€œManage Billing & Subscriptionâ€, and format the button so the text goes on to two line
â€¢	Tooltip (optional): â€œView invoices, update payment method, or cancel your subscriptionâ€
â€¢	Disabled state: while request is in flight.
2. Wire the button to call the manage-billing Edge Function
â€¢	On click:
o	Call /functions/v1/manage-billing with:
json
{
  "customerId": user.stripe_customer_id,
  "returnUrl": "https://elementle-game.replit.app/account"
}
o	Redirect the user to the returned session.url.
3. Handle redirect back from Stripe
â€¢	After the user finishes in Stripe, theyâ€™ll be redirected back to /account.
â€¢	Ensure the page re-renders or refreshes subscription state on return (e.g., re-run useSubscription hook).
â€¢	Show the updated subscription status and benefits.
ğŸ§ª Example frontend call (guidance only)
ts
async function onManageBillingClick(user) {
  const res = await fetch("/functions/v1/manage-billing", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      customerId: user.stripe_customer_id,
      returnUrl: window.location.origin + "/account"
    })
  });

  const { url } = await res.json();
  window.location.href = url; // Redirect to Stripe portal
}
4.	Move the auto renew toggle to the right of the â€œRenews onâ€ text near the top, just below the new. And make the â€œRenews onâ€ text change to â€œExpires onâ€ when the toggle has been set to off e.g. when the subscription wonâ€™t auto renew

âœ… Summary for Replit
â€¢	Already done: Stripe Customer Portal configured, manage-billing Edge Function deployed, schema fields confirmed.
â€¢	Needs doing: Add a button to ManageSubscriptionPage, wire it to call manage-billing, redirect user to Stripe, and refresh subscription state when they return. Move the auto-renew toggle and make the â€œRenews onâ€ text dynamic with the toggle change
â€¢	Guidance provided: Example code for the fetch call, but you should adapt to the existing frontend structure and hooks.
