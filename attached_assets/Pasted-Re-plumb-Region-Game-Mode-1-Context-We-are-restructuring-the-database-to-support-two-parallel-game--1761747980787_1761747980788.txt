Re‑plumb Region Game Mode
1. Context
We are restructuring the database to support two parallel game modes:

Region Game (the existing daily puzzle, shared by all users in a region).

User Game (a personalised version, seeded per user, to be wired up later).

For now, the priority is to make the current game work as the Region Game. That means the user experience, flow, and behaviour should remain identical to what we had before — but all queries and data access must be re‑plumbed to the new region‑specific tables.

2. Database Changes
Renamed tables (region mode)
game_attempts → game_attempts_region

guesses → guesses_region

user_stats → user_stats_region

Region‑specific question pipeline
questions_master_region (canonical question bank)

questions_allocated_region (daily allocations per region)

game_attempts_region (user attempts for region puzzles)

guesses_region (individual guesses per attempt)

user_stats_region (aggregated stats for region mode)

Shared tables (unchanged)
user_profiles

user_settings

user_subscriptions

categories

3. What Needs to Be Re‑Plumbed
Every part of the app that previously referenced the old tables must now point to the new region‑specific ones. The behaviour should remain identical.

a) PlayPage (today’s puzzle)
Previously: pulled from puzzles joined to game_attempts and guesses.

Now: pull from questions_allocated_region → questions_master_region, joined to game_attempts_region and guesses_region.

b) Recording attempts
Insert into game_attempts_region when a user starts a puzzle.

Ensure uniqueness per (user_id, allocated_region_id).

c) Recording guesses
Insert into guesses_region, linked to the correct game_attempts_region.id.

All guess history for in‑progress games should now come from guesses_region.

d) Marking results
Update game_attempts_region.result, num_guesses, and completed_at when the game ends.

This mirrors the old behaviour, just with the renamed table.

e) Archive screen
Previously: archive pulled from puzzles + game_attempts + guesses.

Now: archive must pull from questions_allocated_region + questions_master_region, joined to game_attempts_region and guesses_region.

Ensure the archive only shows completed games (won or lost), not in‑progress.

f) Stats screen
All stats queries must now point to user_stats_region.

Streaks, guess distributions, and totals should be calculated from game_attempts_region and guesses_region.

The “total games” count should reflect only completed games (won/lost), not in‑progress.

g) Streaks
Streak logic must be recalculated from game_attempts_region (using result and completed_at).

Ensure streaks are isolated to the region mode.

h) EndGame modal
When showing the correct answer and user’s guesses, pull from questions_master_region and guesses_region.

4. Validation Criteria
When Replit has re‑plumbed the region mode:

A user can play the daily puzzle exactly as before.

Guesses are stored in guesses_region.

Attempts are tracked in game_attempts_region.

Stats and streaks update in user_stats_region.

Archive view shows past region puzzles correctly.

EndGame modal shows the correct answer and the user’s guess history from the new tables.

5. Next Phase (not yet)
Once the region mode is stable, we will:

Wire up the user mode equivalents (*_user tables).

Add a toggle in the game selection screen to switch between “Region Game” and “User Game.”

Ensure stats, streaks, and archives are isolated per mode.